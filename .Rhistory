df$Valor_Carteira[i] <- sum(df[i,paste("ValorMercado",papel,sep="_")])
# Custo consolidado da carteira
df$Custo_Carteira[i] <- sum(df[i,paste("Custo",papel,sep="_")])
}
# Calculando a valorização da carteira
df$Valorizacao_Carteira <- (df$Valor_Carteira - df$Custo_Carteira)/df$Custo_Carteira
grep("Qtde",names(df),value=T)
papel
papel = df_carteiras[t,seq(5)]
papel
grep("Qtde",names(df),value=T)
t <- 9
# Definindo os papeis presentes na carteira da iteração
papeis_carteira <- as.matrix(df_carteiras[t,seq(TAM)])
papeis_carteira
df_cot4 <- df_cot3[df_cot3$DiaUtil==dia_util,c("Data",papeis_carteira)]
df_prov2 <- df_prov[df_prov$Papel %in% papeis_carteira,]
df_desd2 <- df_desd[df_desd$Papel %in% papeis_carteira,]
df_prov2
df_sim <- df_cot4
row.names(df_sim) <- seq(nrow(df_sim))
for(colu in seq(TAM)){
x <- data.frame(rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)))
names(x) <- c(paste("Custo",papeis_carteira[colu],sep="_"),paste("Qtde",papeis_carteira[colu],sep="_"),paste("PM",papeis_carteira[colu],sep="_"),
paste("ValorMercado",papeis_carteira[colu],sep="_"),paste("Valorizacao",papeis_carteira[colu],sep="_"),paste("Concentracao",papeis_carteira[colu],sep="_"),
paste("Provent",papeis_carteira[colu],sep="_"))
df_sim <- cbind(df_sim,x)
}
df_sim$Montante_Prove <- 0
df_sim$Saldo_Restante <- 0
df_sim$Valor_Carteira <- 0
df_sim$Custo_Carteira <- 0
# head(df_sim)
head(df_sim)
# Gerando o aporte inicial por ação
apo_ini_por_ppl <- aporte_inicial/TAM
df_sim <- primeiro_aporte(df_sim,apo_ini_por_ppl,papeis_carteira)
head(df_sim)
papeis_carteira
df_sim <- demais_aportes(df_sim,papeis_carteira,aporte_mensal,vec_pesos)
papeis_carteira
t
papel = df_carteiras[t,seq(5)]
papel
df = df_sim
papel = df_carteiras[t,seq(5)]
apo_mensal = 2000
vec_pes = vec_pesos
i <- 45
print(paste("i = ",i,sep=""))
# Criando os vetores auxiliares
vec_prev_qtde <- df[i-1,paste("Qtde",papel,sep="_")]
# grep("Qtde",names(df),value=T)
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papel,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papel,sep="_")
vec_prev_qtde
df[seq(1,i-1),paste("Qtde",papel,sep="_")]
for(i in seq(2,44)){
print(paste("i = ",i,sep=""))
# Criando os vetores auxiliares
vec_prev_qtde <- df[i-1,paste("Qtde",papel,sep="_")]
# df[seq(1,i-1),paste("Qtde",papel,sep="_")]
# grep("Qtde",names(df),value=T)
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papel,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papel,sep="_")
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papel,df$Data[i],df$Data[i-1])
############################################################
# Função de proventos
############################################################
vec_valo_prov <- proventos(df,vec_valo_prov,papel,df$Data[i],df$Data[i-1])
############################################################
# Função de aportes
############################################################
# Calculando o valor atual
valor_atual <- round(vec_prev_qtde*df[i,papel],2)
# Calculando o custo atual
custo_atual <- df[i-1,paste("Custo",papel,sep="_")]
# Calculando a Valorização atual
valorizacao_atual <- round((valor_atual-custo_atual)/custo_atual,4)
# Calculando a distribuição atual
distrib_atual <- round(valor_atual/sum(valor_atual),2)
# Chamando a função para calcular quanto aportar em cada ação
vec_valo_apor <- aportes(vec_valo_apor,vec_valo_prov,papel,valorizacao_atual,distrib_atual,apo_mensal,df$Saldo_Restante[i-1],vec_pes)
###########################################################
# Comprando ações
###########################################################
# Calculando quantidade de papéis adquiridos
pap_adq <- floor(vec_valo_apor/df[i,papel])
###########################################################
# Preenchendo as informações do mês após as compras
###########################################################
# Preenchendo a quantidade de ações após compra
df[i,paste("Qtde",papel,sep="_")] <- vec_prev_qtde + pap_adq
# Preenchendo o custo
df[i,paste("Custo",papel,sep="_")] <- df[i-1,paste("Custo",papel,sep="_")] + round(pap_adq*df[i,papel],2)
# Preenchendo o PM
df[i,paste("PM",papel,sep="_")] <- round(df[i,paste("Custo",papel,sep="_")]/df[i,paste("Qtde",papel,sep="_")],2)
# Preenchendo o Valor de Mercado
df[i,paste("ValorMercado",papel,sep="_")] <- round(df[i,paste("Qtde",papel,sep="_")]*df[i,papel],2)
# Preenchendo a Valorização
df[i,paste("Valorizacao",papel,sep="_")] <- round((df[i,paste("ValorMercado",papel,sep="_")]-df[i,paste("Custo",papel,sep="_")])/df[i,paste("Custo",papel,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df[i,paste("Concentracao",papel,sep="_")] <- round(df[i,paste("ValorMercado",papel,sep="_")]/sum(df[i,grep("ValorMercado",names(df),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df[i,paste("Provent",papel,sep="_")] <- vec_valo_prov
# Calculando o montante dos proventos
df$Montante_Prove[i] <- sum(vec_valo_prov)
# Calculando o saldo restante
df$Saldo_Restante[i] <- (apo_mensal + df$Saldo_Restante[i-1] + sum(vec_valo_prov)) - sum(round(pap_adq*df[i,papel],2))
# Valor consolidado da carteira
df$Valor_Carteira[i] <- sum(df[i,paste("ValorMercado",papel,sep="_")])
# Custo consolidado da carteira
df$Custo_Carteira[i] <- sum(df[i,paste("Custo",papel,sep="_")])
}
# i <- 45
i <- 2
print(paste("i = ",i,sep=""))
# Criando os vetores auxiliares
vec_prev_qtde <- df[i-1,paste("Qtde",papel,sep="_")]
# df[seq(1,i-1),paste("Qtde",papel,sep="_")]
# grep("Qtde",names(df),value=T)
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papel,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papel,sep="_")
vec_prev_qtde
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papel,df$Data[i],df$Data[i-1])
vec_prev_qtde
############################################################
# Função de proventos
############################################################
vec_valo_prov <- proventos(df,vec_valo_prov,papel,df$Data[i],df$Data[i-1])
vec_valo_prov
# Calculando o valor atual
valor_atual <- round(vec_prev_qtde*df[i,papel],2)
valor_atual
vec_prev_qtde
papel
df[i,papel]
papel = as.matrix(df_carteiras[t,seq(TAM)])
papel
class(papel)
print(paste("i = ",i,sep=""))
# Criando os vetores auxiliares
vec_prev_qtde <- df[i-1,paste("Qtde",papel,sep="_")]
# df[seq(1,i-1),paste("Qtde",papel,sep="_")]
# grep("Qtde",names(df),value=T)
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papel,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papel,sep="_")
vec_prev_qtde
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papel,df$Data[i],df$Data[i-1])
vec_prev_qtde
############################################################
# Função de proventos
############################################################
vec_valo_prov <- proventos(df,vec_valo_prov,papel,df$Data[i],df$Data[i-1])
# Calculando o valor atual
valor_atual <- round(vec_prev_qtde*df[i,papel],2)
valor_atual
# Calculando o custo atual
custo_atual <- df[i-1,paste("Custo",papel,sep="_")]
# Calculando a Valorização atual
valorizacao_atual <- round((valor_atual-custo_atual)/custo_atual,4)
# Calculando a distribuição atual
distrib_atual <- round(valor_atual/sum(valor_atual),2)
# Chamando a função para calcular quanto aportar em cada ação
vec_valo_apor <- aportes(vec_valo_apor,vec_valo_prov,papel,valorizacao_atual,distrib_atual,apo_mensal,df$Saldo_Restante[i-1],vec_pes)
vec_valo_apor
# Calculando quantidade de papéis adquiridos
pap_adq <- floor(vec_valo_apor/df[i,papel])
pap_adq
# Preenchendo a quantidade de ações após compra
df[i,paste("Qtde",papel,sep="_")] <- vec_prev_qtde + pap_adq
# Preenchendo o custo
df[i,paste("Custo",papel,sep="_")] <- df[i-1,paste("Custo",papel,sep="_")] + round(pap_adq*df[i,papel],2)
# Preenchendo o PM
df[i,paste("PM",papel,sep="_")] <- round(df[i,paste("Custo",papel,sep="_")]/df[i,paste("Qtde",papel,sep="_")],2)
# Preenchendo o Valor de Mercado
df[i,paste("ValorMercado",papel,sep="_")] <- round(df[i,paste("Qtde",papel,sep="_")]*df[i,papel],2)
# Preenchendo a Valorização
df[i,paste("Valorizacao",papel,sep="_")] <- round((df[i,paste("ValorMercado",papel,sep="_")]-df[i,paste("Custo",papel,sep="_")])/df[i,paste("Custo",papel,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df[i,paste("Concentracao",papel,sep="_")] <- round(df[i,paste("ValorMercado",papel,sep="_")]/sum(df[i,grep("ValorMercado",names(df),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df[i,paste("Provent",papel,sep="_")] <- vec_valo_prov
# Calculando o montante dos proventos
df$Montante_Prove[i] <- sum(vec_valo_prov)
# Calculando o saldo restante
df$Saldo_Restante[i] <- (apo_mensal + df$Saldo_Restante[i-1] + sum(vec_valo_prov)) - sum(round(pap_adq*df[i,papel],2))
# Valor consolidado da carteira
df$Valor_Carteira[i] <- sum(df[i,paste("ValorMercado",papel,sep="_")])
# Custo consolidado da carteira
df$Custo_Carteira[i] <- sum(df[i,paste("Custo",papel,sep="_")])
df[i]
for(i in seq(2,44)){
print(paste("i = ",i,sep=""))
# Criando os vetores auxiliares
vec_prev_qtde <- df[i-1,paste("Qtde",papel,sep="_")]
# df[seq(1,i-1),paste("Qtde",papel,sep="_")]
# grep("Qtde",names(df),value=T)
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papel,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papel,sep="_")
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papel,df$Data[i],df$Data[i-1])
############################################################
# Função de proventos
############################################################
vec_valo_prov <- proventos(df,vec_valo_prov,papel,df$Data[i],df$Data[i-1])
############################################################
# Função de aportes
############################################################
# Calculando o valor atual
valor_atual <- round(vec_prev_qtde*df[i,papel],2)
# Calculando o custo atual
custo_atual <- df[i-1,paste("Custo",papel,sep="_")]
# Calculando a Valorização atual
valorizacao_atual <- round((valor_atual-custo_atual)/custo_atual,4)
# Calculando a distribuição atual
distrib_atual <- round(valor_atual/sum(valor_atual),2)
# Chamando a função para calcular quanto aportar em cada ação
vec_valo_apor <- aportes(vec_valo_apor,vec_valo_prov,papel,valorizacao_atual,distrib_atual,apo_mensal,df$Saldo_Restante[i-1],vec_pes)
###########################################################
# Comprando ações
###########################################################
# Calculando quantidade de papéis adquiridos
pap_adq <- floor(vec_valo_apor/df[i,papel])
###########################################################
# Preenchendo as informações do mês após as compras
###########################################################
# Preenchendo a quantidade de ações após compra
df[i,paste("Qtde",papel,sep="_")] <- vec_prev_qtde + pap_adq
# Preenchendo o custo
df[i,paste("Custo",papel,sep="_")] <- df[i-1,paste("Custo",papel,sep="_")] + round(pap_adq*df[i,papel],2)
# Preenchendo o PM
df[i,paste("PM",papel,sep="_")] <- round(df[i,paste("Custo",papel,sep="_")]/df[i,paste("Qtde",papel,sep="_")],2)
# Preenchendo o Valor de Mercado
df[i,paste("ValorMercado",papel,sep="_")] <- round(df[i,paste("Qtde",papel,sep="_")]*df[i,papel],2)
# Preenchendo a Valorização
df[i,paste("Valorizacao",papel,sep="_")] <- round((df[i,paste("ValorMercado",papel,sep="_")]-df[i,paste("Custo",papel,sep="_")])/df[i,paste("Custo",papel,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df[i,paste("Concentracao",papel,sep="_")] <- round(df[i,paste("ValorMercado",papel,sep="_")]/sum(df[i,grep("ValorMercado",names(df),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df[i,paste("Provent",papel,sep="_")] <- vec_valo_prov
# Calculando o montante dos proventos
df$Montante_Prove[i] <- sum(vec_valo_prov)
# Calculando o saldo restante
df$Saldo_Restante[i] <- (apo_mensal + df$Saldo_Restante[i-1] + sum(vec_valo_prov)) - sum(round(pap_adq*df[i,papel],2))
# Valor consolidado da carteira
df$Valor_Carteira[i] <- sum(df[i,paste("ValorMercado",papel,sep="_")])
# Custo consolidado da carteira
df$Custo_Carteira[i] <- sum(df[i,paste("Custo",papel,sep="_")])
}
i <- 45
print(paste("i = ",i,sep=""))
# Criando os vetores auxiliares
vec_prev_qtde <- df[i-1,paste("Qtde",papel,sep="_")]
vec_prev_qtde
# df[seq(1,i-1),paste("Qtde",papel,sep="_")]
# grep("Qtde",names(df),value=T)
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papel,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papel,sep="_")
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papel,df$Data[i],df$Data[i-1])
vec_prev_qtde
############################################################
# Função de proventos
############################################################
vec_valo_prov <- proventos(df,vec_valo_prov,papel,df$Data[i],df$Data[i-1])
vec_valo_prov
# Calculando o valor atual
valor_atual <- round(vec_prev_qtde*df[i,papel],2)
valor_atual
# Calculando o custo atual
custo_atual <- df[i-1,paste("Custo",papel,sep="_")]
custo_atual
# Calculando a Valorização atual
valorizacao_atual <- round((valor_atual-custo_atual)/custo_atual,4)
valorizacao_atual
# Calculando a distribuição atual
distrib_atual <- round(valor_atual/sum(valor_atual),2)
distrib_atual
valor_atual
valor_atual/sum(valor_atual)
# Calculando a distribuição atual
distrib_atual <- round(valor_atual/sum(valor_atual),4)
distrib_atual
# Chamando a função para calcular quanto aportar em cada ação
vec_valo_apor <- aportes(vec_valo_apor,vec_valo_prov,papel,valorizacao_atual,distrib_atual,apo_mensal,df$Saldo_Restante[i-1],vec_pes)
vec_valo_apor
# Calculando quantidade de papéis adquiridos
pap_adq <- floor(vec_valo_apor/df[i,papel])
pap_adq
# Preenchendo a quantidade de ações após compra
df[i,paste("Qtde",papel,sep="_")] <- vec_prev_qtde + pap_adq
# Preenchendo o custo
df[i,paste("Custo",papel,sep="_")] <- df[i-1,paste("Custo",papel,sep="_")] + round(pap_adq*df[i,papel],2)
# Preenchendo o PM
df[i,paste("PM",papel,sep="_")] <- round(df[i,paste("Custo",papel,sep="_")]/df[i,paste("Qtde",papel,sep="_")],2)
# Preenchendo o Valor de Mercado
df[i,paste("ValorMercado",papel,sep="_")] <- round(df[i,paste("Qtde",papel,sep="_")]*df[i,papel],2)
# Preenchendo a Valorização
df[i,paste("Valorizacao",papel,sep="_")] <- round((df[i,paste("ValorMercado",papel,sep="_")]-df[i,paste("Custo",papel,sep="_")])/df[i,paste("Custo",papel,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df[i,paste("Concentracao",papel,sep="_")] <- round(df[i,paste("ValorMercado",papel,sep="_")]/sum(df[i,grep("ValorMercado",names(df),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df[i,paste("Provent",papel,sep="_")] <- vec_valo_prov
# Calculando o montante dos proventos
df$Montante_Prove[i] <- sum(vec_valo_prov)
# Calculando o saldo restante
df$Saldo_Restante[i] <- (apo_mensal + df$Saldo_Restante[i-1] + sum(vec_valo_prov)) - sum(round(pap_adq*df[i,papel],2))
# Valor consolidado da carteira
df$Valor_Carteira[i] <- sum(df[i,paste("ValorMercado",papel,sep="_")])
# Custo consolidado da carteira
df$Custo_Carteira[i] <- sum(df[i,paste("Custo",papel,sep="_")])
for(i in seq(2,nrow(df))){
# for(i in seq(2,44)){
print(paste("i = ",i,sep=""))
# Criando os vetores auxiliares
vec_prev_qtde <- df[i-1,paste("Qtde",papel,sep="_")]
# df[seq(1,i-1),paste("Qtde",papel,sep="_")]
# grep("Qtde",names(df),value=T)
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papel,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papel,sep="_")
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papel,df$Data[i],df$Data[i-1])
############################################################
# Função de proventos
############################################################
vec_valo_prov <- proventos(df,vec_valo_prov,papel,df$Data[i],df$Data[i-1])
############################################################
# Função de aportes
############################################################
# Calculando o valor atual
valor_atual <- round(vec_prev_qtde*df[i,papel],2)
# Calculando o custo atual
custo_atual <- df[i-1,paste("Custo",papel,sep="_")]
# Calculando a Valorização atual
valorizacao_atual <- round((valor_atual-custo_atual)/custo_atual,4)
# Calculando a distribuição atual
distrib_atual <- round(valor_atual/sum(valor_atual),4)
# Chamando a função para calcular quanto aportar em cada ação
vec_valo_apor <- aportes(vec_valo_apor,vec_valo_prov,papel,valorizacao_atual,distrib_atual,apo_mensal,df$Saldo_Restante[i-1],vec_pes)
###########################################################
# Comprando ações
###########################################################
# Calculando quantidade de papéis adquiridos
pap_adq <- floor(vec_valo_apor/df[i,papel])
###########################################################
# Preenchendo as informações do mês após as compras
###########################################################
# Preenchendo a quantidade de ações após compra
df[i,paste("Qtde",papel,sep="_")] <- vec_prev_qtde + pap_adq
# Preenchendo o custo
df[i,paste("Custo",papel,sep="_")] <- df[i-1,paste("Custo",papel,sep="_")] + round(pap_adq*df[i,papel],2)
# Preenchendo o PM
df[i,paste("PM",papel,sep="_")] <- round(df[i,paste("Custo",papel,sep="_")]/df[i,paste("Qtde",papel,sep="_")],2)
# Preenchendo o Valor de Mercado
df[i,paste("ValorMercado",papel,sep="_")] <- round(df[i,paste("Qtde",papel,sep="_")]*df[i,papel],2)
# Preenchendo a Valorização
df[i,paste("Valorizacao",papel,sep="_")] <- round((df[i,paste("ValorMercado",papel,sep="_")]-df[i,paste("Custo",papel,sep="_")])/df[i,paste("Custo",papel,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df[i,paste("Concentracao",papel,sep="_")] <- round(df[i,paste("ValorMercado",papel,sep="_")]/sum(df[i,grep("ValorMercado",names(df),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df[i,paste("Provent",papel,sep="_")] <- vec_valo_prov
# Calculando o montante dos proventos
df$Montante_Prove[i] <- sum(vec_valo_prov)
# Calculando o saldo restante
df$Saldo_Restante[i] <- (apo_mensal + df$Saldo_Restante[i-1] + sum(vec_valo_prov)) - sum(round(pap_adq*df[i,papel],2))
# Valor consolidado da carteira
df$Valor_Carteira[i] <- sum(df[i,paste("ValorMercado",papel,sep="_")])
# Custo consolidado da carteira
df$Custo_Carteira[i] <- sum(df[i,paste("Custo",papel,sep="_")])
}
source('C:/Users/Youse/Desktop/Outros/Investimentos/Investimentos/Analise_Aportes/funcoes.R', encoding = 'UTF-8')
t <- 9
################################
# Preparando as bases
################################
# Definindo os papeis presentes na carteira da iteração
papeis_carteira <- as.matrix(df_carteiras[t,seq(TAM)])
df_cot4 <- df_cot3[df_cot3$DiaUtil==dia_util,c("Data",papeis_carteira)]
df_prov2 <- df_prov[df_prov$Papel %in% papeis_carteira,]
df_desd2 <- df_desd[df_desd$Papel %in% papeis_carteira,]
# head(df_cot4)
# head(df_prov2)
# head(df_desd2)
# UDF_var_domain(df_cot4)
# sapply()
# Criando a base para simulação
df_sim <- df_cot4
row.names(df_sim) <- seq(nrow(df_sim))
for(colu in seq(TAM)){
x <- data.frame(rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)))
names(x) <- c(paste("Custo",papeis_carteira[colu],sep="_"),paste("Qtde",papeis_carteira[colu],sep="_"),paste("PM",papeis_carteira[colu],sep="_"),
paste("ValorMercado",papeis_carteira[colu],sep="_"),paste("Valorizacao",papeis_carteira[colu],sep="_"),paste("Concentracao",papeis_carteira[colu],sep="_"),
paste("Provent",papeis_carteira[colu],sep="_"))
df_sim <- cbind(df_sim,x)
}
df_sim$Montante_Prove <- 0
df_sim$Saldo_Restante <- 0
df_sim$Valor_Carteira <- 0
df_sim$Custo_Carteira <- 0
# head(df_sim)
# Gerando o aporte inicial por ação
apo_ini_por_ppl <- aporte_inicial/TAM
##############################################
# Preenchendo os dados do primeiro mês
##############################################
df_sim <- primeiro_aporte(df_sim,apo_ini_por_ppl,papeis_carteira)
# (df,apo_por_ppl,papel)
# head(df_sim)
##############################################
# Preenchendo os dados dos meses seguintes
##############################################
df_sim <- demais_aportes(df_sim,papeis_carteira,aporte_mensal,vec_pesos)
##################################################
# Preenchendo os dados da tabela com carteiras
##################################################
df_carteiras$Valor[t] <- df_sim$Valor_Carteira[nrow(df_sim)]
df_carteiras$Custo[t] <- df_sim$Custo_Carteira[nrow(df_sim)]
df_carteiras$Valorizacao[t] <- df_sim$Valorizacao_Carteira[nrow(df_sim)]
source('C:/Users/Youse/Desktop/Outros/Investimentos/Investimentos/Analise_Aportes/funcoes.R', encoding = 'UTF-8')
set.seed(249)
dia_util <- sample(seq(18),1) # 3
# Criando vetor com seeds
vec_seeds <- sample(seq(1000),num_carteiras)
df_carteiras <- data.frame(    matrix(rep(0,length(vec_seeds)*TAM),ncol = TAM,byrow = T)      )
names(df_carteiras) <- paste("Papel",seq(TAM),sep="")
head(df_carteiras)
for(h in seq(length(vec_seeds))){
# Definindo a seed
set.seed(vec_seeds[h])
papeis_carteira <- sample(names(df_cot3[2:(ncol(df_cot3)-2)]),qtde_papeis) # "RADL3" "SBSP3" "SANB3" "PSSA3" "ITSA3"
df_carteiras[h,] <- papeis_carteira
}
# row.names(df_carteiras) <- seq(nrow(df_carteiras))
# df_carteiras <- as.data.frame(df_carteiras,row.names = F)
TAM <- qtde_papeis
# df_carteiras <- UDF_var_factor_to_char(df_carteiras)
df_carteiras$Valor <- 0
df_carteiras$Custo <- 0
df_carteiras$Valorizacao <- 0
###########################################################################################################################
###########################################################################################################################
###########################################################################################################################
###########################################################################################################################
###########################################################################################################################
for(t in seq(nrow(df_carteiras))){
print(paste("t = ",t,sep=""))
# t <- 9
################################
# Preparando as bases
################################
# Definindo os papeis presentes na carteira da iteração
papeis_carteira <- as.matrix(df_carteiras[t,seq(TAM)])
df_cot4 <- df_cot3[df_cot3$DiaUtil==dia_util,c("Data",papeis_carteira)]
df_prov2 <- df_prov[df_prov$Papel %in% papeis_carteira,]
df_desd2 <- df_desd[df_desd$Papel %in% papeis_carteira,]
# head(df_cot4)
# head(df_prov2)
# head(df_desd2)
# UDF_var_domain(df_cot4)
# sapply()
# Criando a base para simulação
df_sim <- df_cot4
row.names(df_sim) <- seq(nrow(df_sim))
for(colu in seq(TAM)){
x <- data.frame(rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)))
names(x) <- c(paste("Custo",papeis_carteira[colu],sep="_"),paste("Qtde",papeis_carteira[colu],sep="_"),paste("PM",papeis_carteira[colu],sep="_"),
paste("ValorMercado",papeis_carteira[colu],sep="_"),paste("Valorizacao",papeis_carteira[colu],sep="_"),paste("Concentracao",papeis_carteira[colu],sep="_"),
paste("Provent",papeis_carteira[colu],sep="_"))
df_sim <- cbind(df_sim,x)
}
df_sim$Montante_Prove <- 0
df_sim$Saldo_Restante <- 0
df_sim$Valor_Carteira <- 0
df_sim$Custo_Carteira <- 0
# head(df_sim)
# Gerando o aporte inicial por ação
apo_ini_por_ppl <- aporte_inicial/TAM
##############################################
# Preenchendo os dados do primeiro mês
##############################################
df_sim <- primeiro_aporte(df_sim,apo_ini_por_ppl,papeis_carteira)
# (df,apo_por_ppl,papel)
# head(df_sim)
##############################################
# Preenchendo os dados dos meses seguintes
##############################################
df_sim <- demais_aportes(df_sim,papeis_carteira,aporte_mensal,vec_pesos)
##################################################
# Preenchendo os dados da tabela com carteiras
##################################################
df_carteiras$Valor[t] <- df_sim$Valor_Carteira[nrow(df_sim)]
df_carteiras$Custo[t] <- df_sim$Custo_Carteira[nrow(df_sim)]
df_carteiras$Valorizacao[t] <- df_sim$Valorizacao_Carteira[nrow(df_sim)]
}
head(df_carteiras)
boxplot(df_carteiras$Valorizacao)
