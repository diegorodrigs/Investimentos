df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")] <- df_sim[1,paste("Custo",papeis_carteira,sep="_")]
# Preenchendo a Valorização
df_sim[1,paste("Valorizacao",papeis_carteira,sep="_")] <- round((df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")]-df_sim[1,paste("Custo",papeis_carteira,sep="_")])/df_sim[1,paste("Custo",papeis_carteira,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df_sim[1,paste("Concentracao",papeis_carteira,sep="_")] <- round(df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")]/sum(df_sim[1,grep("ValorMercado",names(df_sim),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df_sim[1,paste("Provent",papeis_carteira,sep="_")] <- 0
df_sim$Montante_Prove <- 0
df_sim[1,"Saldo_Restante"] <- aporte_inicial - sum(df_sim[grep("Custo",names(df_sim),value=T)])
df_sim$Valor_Carteira[1] <- sum(df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")])
df_sim$Custo_Carteira[1] <- sum(df_sim[1,paste("Custo",papeis_carteira,sep="_")])
# head(df_sim)
# sum(df_sim[1,grep("Concentracao",names(df_sim),value=T)])
# Gerando os aportes mensais
for(i in seq(2,nrow(df_sim))){
# Criando os vetores auxiliares
vec_prev_qtde <- df_sim[i-1,paste("Qtde",papeis_carteira,sep="_")]
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papeis_carteira,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papeis_carteira,sep="_")
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papeis_carteira,df_sim$Data[i],df_sim$Data[i-1])
############################################################
# Função de proventos
############################################################
vec_valo_prov <- desdobramentos(vec_valo_prov,papeis_carteira,df_sim$Data[i],df_sim$Data[i-1])
############################################################
# Função de aportes
############################################################
# Calculando o valor atual
valor_atual <- round(vec_prev_qtde*df_sim[i,papeis_carteira],2)
# Calculando o custo atual
custo_atual <- df_sim[i-1,paste("Custo",papeis_carteira,sep="_")]
# Calculando a Valorização atual
valorizacao_atual <- round((valor_atual-custo_atual)/custo_atual,4)
# Calculando a distribuição atual
distrib_atual <- round(valor_atual/sum(valor_atual),2)
# Chamando a função para calcular quanto aportar em cada ação
vec_valo_apor <- aportes(vec_valo_apor,vec_valo_prov,papeis_carteira,valorizacao_atual,distrib_atual,aporte_mensal,df_sim$Saldo_Restante[i-1],vec_pesos)
###########################################################
# Comprando ações
###########################################################
# Calculando quantidade de papéis adquiridos
pap_adq <- floor(vec_valo_apor/df_sim[i,papeis_carteira])
###########################################################
# Preenchendo as informações do mês após as compras
###########################################################
# Preenchendo a quantidade de ações após compra
df_sim[i,paste("Qtde",papeis_carteira,sep="_")] <- vec_prev_qtde + pap_adq
# Preenchendo o custo
df_sim[i,paste("Custo",papeis_carteira,sep="_")] <- df_sim[i-1,paste("Custo",papeis_carteira,sep="_")] + round(pap_adq*df_sim[i,papeis_carteira],2)
# Preenchendo o PM
df_sim[i,paste("PM",papeis_carteira,sep="_")] <- round(df_sim[i,paste("Custo",papeis_carteira,sep="_")]/df_sim[i,paste("Qtde",papeis_carteira,sep="_")],2)
# Preenchendo o Valor de Mercado
df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")] <- round(df_sim[i,paste("Qtde",papeis_carteira,sep="_")]*df_sim[i,papeis_carteira],2)
# Preenchendo a Valorização
df_sim[i,paste("Valorizacao",papeis_carteira,sep="_")] <- round((df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")]-df_sim[i,paste("Custo",papeis_carteira,sep="_")])/df_sim[i,paste("Custo",papeis_carteira,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df_sim[i,paste("Concentracao",papeis_carteira,sep="_")] <- round(df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")]/sum(df_sim[i,grep("ValorMercado",names(df_sim),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df_sim[i,paste("Provent",papeis_carteira,sep="_")] <- vec_valo_prov
# Calculando o montante dos proventos
df_sim$Montante_Prove[i] <- sum(vec_valo_prov)
# Calculando o saldo restante
df_sim$Saldo_Restante[i] <- (aporte_mensal + df_sim$Saldo_Restante[i-1] + sum(vec_valo_prov)) - sum(round(pap_adq*df_sim[i,papeis_carteira],2))
# Valor consolidado da carteira
df_sim$Valor_Carteira[i] <- sum(df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")])
# CUsto consolidado da carteira
df_sim$Custo_Carteira[i] <- sum(df_sim[i,paste("Custo",papeis_carteira,sep="_")])
}
head(df_sim,5)
# plot(df_sim$Saldo_Restante)
plot(x=df_sim$Data,y=df_sim$Valor_Carteira,col="blue",type="l")
lines(x=df_sim$Data,y=df_sim$Custo_Carteira,col="red")
tail(df_sim)
source('C:/Users/Diego/Desktop/Data_Science/Investimentos/Analise_Aportes/funcoes.R', encoding = 'UTF-8')
format(df_sim$Data,"%Y")
df_sim[format(df_sim$Data,"%Y")=="2014",]
df_desd2
# Criando a base para simulação
df_sim <- df_cot4
head(df_cot4)
row.names(df_sim) <- seq(nrow(df_sim))
head(df_sim)
# Criando a base para simulação
df_sim <- df_cot4
row.names(df_sim) <- seq(nrow(df_sim))
for(colu in seq(TAM)){
x <- data.frame(rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)))
names(x) <- c(paste("Custo",papeis_carteira[colu],sep="_"),paste("Qtde",papeis_carteira[colu],sep="_"),paste("PM",papeis_carteira[colu],sep="_"),
paste("ValorMercado",papeis_carteira[colu],sep="_"),paste("Valorizacao",papeis_carteira[colu],sep="_"),paste("Concentracao",papeis_carteira[colu],sep="_"),
paste("Provent",papeis_carteira[colu],sep="_"))
df_sim <- cbind(df_sim,x)
}
df_sim$Montante_Prove <- 0
df_sim$Saldo_Restante <- 0
df_sim$Valor_Carteira <- 0
df_sim$Custo_Carteira <- 0
# head(df_sim)
# Gerando o aporte inicial
apo_ini_por_ppl <- aporte_inicial/TAM
# for(colu in seq(TAM)){
# # Preenchendo a quantidade de ações
# df_sim[1,paste("Qtde",papeis_carteira[colu],sep="_")] <- floor(apo_ini_por_ppl/df_sim[1,papeis_carteira[colu]])
#
# # Preenchendo o custo
# df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")] <- round(df_sim[1,paste("Qtde",papeis_carteira[colu],sep="_")]*df_sim[1,papeis_carteira[colu]],2)
#
# # Preenchendo o PM
# df_sim[1,paste("PM",papeis_carteira[colu],sep="_")] <- df_sim[1,papeis_carteira[colu]]
#
# # Preenchendo o Valor de Mercado
# df_sim[1,paste("ValorMercado",papeis_carteira[colu],sep="_")] <- df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")]
#
# # Preenchendo a Valorização
# df_sim[1,paste("Valorizacao",papeis_carteira[colu],sep="_")] <- round((df_sim[1,paste("ValorMercado",papeis_carteira[colu],sep="_")]-df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")])/df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")],2)
#
# # Preenchendo a concentração no papel dentro da carteira
# df_sim[1,paste("Concentracao",papeis_carteira[colu],sep="_")] <- round(df_sim[1,paste("ValorMercado",papeis_carteira[colu],sep="_")]/sum(df_sim[1,grep("ValorMercado",names(df_sim),value=T)]),2)
#
# # Preenchendo o montante de proventos recebidos para o dado papel no dado mês
# df_sim[1,paste("Provent",papeis_carteira[colu],sep="_")] <- 0
# }
##############################################
# Preenchendo os dados do primeiro mês
##############################################
# Preenchendo a quantidade de ações
df_sim[1,paste("Qtde",papeis_carteira,sep="_")] <- floor(apo_ini_por_ppl/df_sim[1,papeis_carteira])
# Preenchendo o custo
df_sim[1,paste("Custo",papeis_carteira,sep="_")] <- round(df_sim[1,paste("Qtde",papeis_carteira,sep="_")]*df_sim[1,papeis_carteira],2)
# Preenchendo o PM
df_sim[1,paste("PM",papeis_carteira,sep="_")] <- df_sim[1,papeis_carteira]
# Preenchendo o Valor de Mercado
df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")] <- df_sim[1,paste("Custo",papeis_carteira,sep="_")]
# Preenchendo a Valorização
df_sim[1,paste("Valorizacao",papeis_carteira,sep="_")] <- round((df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")]-df_sim[1,paste("Custo",papeis_carteira,sep="_")])/df_sim[1,paste("Custo",papeis_carteira,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df_sim[1,paste("Concentracao",papeis_carteira,sep="_")] <- round(df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")]/sum(df_sim[1,grep("ValorMercado",names(df_sim),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df_sim[1,paste("Provent",papeis_carteira,sep="_")] <- 0
df_sim$Montante_Prove <- 0
df_sim[1,"Saldo_Restante"] <- aporte_inicial - sum(df_sim[grep("Custo",names(df_sim),value=T)])
df_sim$Valor_Carteira[1] <- sum(df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")])
df_sim$Custo_Carteira[1] <- sum(df_sim[1,paste("Custo",papeis_carteira,sep="_")])
# head(df_sim)
# sum(df_sim[1,grep("Concentracao",names(df_sim),value=T)])
# Gerando os aportes mensais
for(i in seq(2,nrow(df_sim))){
# Criando os vetores auxiliares
vec_prev_qtde <- df_sim[i-1,paste("Qtde",papeis_carteira,sep="_")]
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papeis_carteira,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papeis_carteira,sep="_")
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papeis_carteira,df_sim$Data[i],df_sim$Data[i-1])
############################################################
# Função de proventos
############################################################
vec_valo_prov <- desdobramentos(vec_valo_prov,papeis_carteira,df_sim$Data[i],df_sim$Data[i-1])
############################################################
# Função de aportes
############################################################
# Calculando o valor atual
valor_atual <- round(vec_prev_qtde*df_sim[i,papeis_carteira],2)
# Calculando o custo atual
custo_atual <- df_sim[i-1,paste("Custo",papeis_carteira,sep="_")]
# Calculando a Valorização atual
valorizacao_atual <- round((valor_atual-custo_atual)/custo_atual,4)
# Calculando a distribuição atual
distrib_atual <- round(valor_atual/sum(valor_atual),2)
# Chamando a função para calcular quanto aportar em cada ação
vec_valo_apor <- aportes(vec_valo_apor,vec_valo_prov,papeis_carteira,valorizacao_atual,distrib_atual,aporte_mensal,df_sim$Saldo_Restante[i-1],vec_pesos)
###########################################################
# Comprando ações
###########################################################
# Calculando quantidade de papéis adquiridos
pap_adq <- floor(vec_valo_apor/df_sim[i,papeis_carteira])
###########################################################
# Preenchendo as informações do mês após as compras
###########################################################
# Preenchendo a quantidade de ações após compra
df_sim[i,paste("Qtde",papeis_carteira,sep="_")] <- vec_prev_qtde + pap_adq
# Preenchendo o custo
df_sim[i,paste("Custo",papeis_carteira,sep="_")] <- df_sim[i-1,paste("Custo",papeis_carteira,sep="_")] + round(pap_adq*df_sim[i,papeis_carteira],2)
# Preenchendo o PM
df_sim[i,paste("PM",papeis_carteira,sep="_")] <- round(df_sim[i,paste("Custo",papeis_carteira,sep="_")]/df_sim[i,paste("Qtde",papeis_carteira,sep="_")],2)
# Preenchendo o Valor de Mercado
df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")] <- round(df_sim[i,paste("Qtde",papeis_carteira,sep="_")]*df_sim[i,papeis_carteira],2)
# Preenchendo a Valorização
df_sim[i,paste("Valorizacao",papeis_carteira,sep="_")] <- round((df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")]-df_sim[i,paste("Custo",papeis_carteira,sep="_")])/df_sim[i,paste("Custo",papeis_carteira,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df_sim[i,paste("Concentracao",papeis_carteira,sep="_")] <- round(df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")]/sum(df_sim[i,grep("ValorMercado",names(df_sim),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df_sim[i,paste("Provent",papeis_carteira,sep="_")] <- vec_valo_prov
# Calculando o montante dos proventos
df_sim$Montante_Prove[i] <- sum(vec_valo_prov)
# Calculando o saldo restante
df_sim$Saldo_Restante[i] <- (aporte_mensal + df_sim$Saldo_Restante[i-1] + sum(vec_valo_prov)) - sum(round(pap_adq*df_sim[i,papeis_carteira],2))
# Valor consolidado da carteira
df_sim$Valor_Carteira[i] <- sum(df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")])
# CUsto consolidado da carteira
df_sim$Custo_Carteira[i] <- sum(df_sim[i,paste("Custo",papeis_carteira,sep="_")])
}
df_sim[format(df_sim$Data,"%Y")=="2014",]
df_sim[format(df_sim$Data,"%Y")=="2014",grep("SANB3",names(df_sim),value=T)]
df_desd2
df_sim[format(df_sim$Data,"%Y")=="2014",c("Data",grep("SANB3",names(df_sim),value=T))]
63349/55
1151.8*7.71
source('C:/Users/Diego/Desktop/Data_Science/Investimentos/Analise_Aportes/funcoes.R', encoding = 'UTF-8')
# Criando a base para simulação
df_sim <- df_cot4
row.names(df_sim) <- seq(nrow(df_sim))
for(colu in seq(TAM)){
x <- data.frame(rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)))
names(x) <- c(paste("Custo",papeis_carteira[colu],sep="_"),paste("Qtde",papeis_carteira[colu],sep="_"),paste("PM",papeis_carteira[colu],sep="_"),
paste("ValorMercado",papeis_carteira[colu],sep="_"),paste("Valorizacao",papeis_carteira[colu],sep="_"),paste("Concentracao",papeis_carteira[colu],sep="_"),
paste("Provent",papeis_carteira[colu],sep="_"))
df_sim <- cbind(df_sim,x)
}
df_sim$Montante_Prove <- 0
df_sim$Saldo_Restante <- 0
df_sim$Valor_Carteira <- 0
df_sim$Custo_Carteira <- 0
# head(df_sim)
# Gerando o aporte inicial
apo_ini_por_ppl <- aporte_inicial/TAM
# for(colu in seq(TAM)){
# # Preenchendo a quantidade de ações
# df_sim[1,paste("Qtde",papeis_carteira[colu],sep="_")] <- floor(apo_ini_por_ppl/df_sim[1,papeis_carteira[colu]])
#
# # Preenchendo o custo
# df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")] <- round(df_sim[1,paste("Qtde",papeis_carteira[colu],sep="_")]*df_sim[1,papeis_carteira[colu]],2)
#
# # Preenchendo o PM
# df_sim[1,paste("PM",papeis_carteira[colu],sep="_")] <- df_sim[1,papeis_carteira[colu]]
#
# # Preenchendo o Valor de Mercado
# df_sim[1,paste("ValorMercado",papeis_carteira[colu],sep="_")] <- df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")]
#
# # Preenchendo a Valorização
# df_sim[1,paste("Valorizacao",papeis_carteira[colu],sep="_")] <- round((df_sim[1,paste("ValorMercado",papeis_carteira[colu],sep="_")]-df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")])/df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")],2)
#
# # Preenchendo a concentração no papel dentro da carteira
# df_sim[1,paste("Concentracao",papeis_carteira[colu],sep="_")] <- round(df_sim[1,paste("ValorMercado",papeis_carteira[colu],sep="_")]/sum(df_sim[1,grep("ValorMercado",names(df_sim),value=T)]),2)
#
# # Preenchendo o montante de proventos recebidos para o dado papel no dado mês
# df_sim[1,paste("Provent",papeis_carteira[colu],sep="_")] <- 0
# }
##############################################
# Preenchendo os dados do primeiro mês
##############################################
# Preenchendo a quantidade de ações
df_sim[1,paste("Qtde",papeis_carteira,sep="_")] <- floor(apo_ini_por_ppl/df_sim[1,papeis_carteira])
# Preenchendo o custo
df_sim[1,paste("Custo",papeis_carteira,sep="_")] <- round(df_sim[1,paste("Qtde",papeis_carteira,sep="_")]*df_sim[1,papeis_carteira],2)
# Preenchendo o PM
df_sim[1,paste("PM",papeis_carteira,sep="_")] <- df_sim[1,papeis_carteira]
# Preenchendo o Valor de Mercado
df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")] <- df_sim[1,paste("Custo",papeis_carteira,sep="_")]
# Preenchendo a Valorização
df_sim[1,paste("Valorizacao",papeis_carteira,sep="_")] <- round((df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")]-df_sim[1,paste("Custo",papeis_carteira,sep="_")])/df_sim[1,paste("Custo",papeis_carteira,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df_sim[1,paste("Concentracao",papeis_carteira,sep="_")] <- round(df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")]/sum(df_sim[1,grep("ValorMercado",names(df_sim),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df_sim[1,paste("Provent",papeis_carteira,sep="_")] <- 0
df_sim$Montante_Prove <- 0
df_sim[1,"Saldo_Restante"] <- aporte_inicial - sum(df_sim[grep("Custo",names(df_sim),value=T)])
df_sim$Valor_Carteira[1] <- sum(df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")])
df_sim$Custo_Carteira[1] <- sum(df_sim[1,paste("Custo",papeis_carteira,sep="_")])
# head(df_sim)
# sum(df_sim[1,grep("Concentracao",names(df_sim),value=T)])
# Gerando os aportes mensais
for(i in seq(2,nrow(df_sim))){
# Criando os vetores auxiliares
vec_prev_qtde <- df_sim[i-1,paste("Qtde",papeis_carteira,sep="_")]
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papeis_carteira,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papeis_carteira,sep="_")
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papeis_carteira,df_sim$Data[i],df_sim$Data[i-1])
############################################################
# Função de proventos
############################################################
vec_valo_prov <- desdobramentos(vec_valo_prov,papeis_carteira,df_sim$Data[i],df_sim$Data[i-1])
############################################################
# Função de aportes
############################################################
# Calculando o valor atual
valor_atual <- round(vec_prev_qtde*df_sim[i,papeis_carteira],2)
# Calculando o custo atual
custo_atual <- df_sim[i-1,paste("Custo",papeis_carteira,sep="_")]
# Calculando a Valorização atual
valorizacao_atual <- round((valor_atual-custo_atual)/custo_atual,4)
# Calculando a distribuição atual
distrib_atual <- round(valor_atual/sum(valor_atual),2)
# Chamando a função para calcular quanto aportar em cada ação
vec_valo_apor <- aportes(vec_valo_apor,vec_valo_prov,papeis_carteira,valorizacao_atual,distrib_atual,aporte_mensal,df_sim$Saldo_Restante[i-1],vec_pesos)
###########################################################
# Comprando ações
###########################################################
# Calculando quantidade de papéis adquiridos
pap_adq <- floor(vec_valo_apor/df_sim[i,papeis_carteira])
###########################################################
# Preenchendo as informações do mês após as compras
###########################################################
# Preenchendo a quantidade de ações após compra
df_sim[i,paste("Qtde",papeis_carteira,sep="_")] <- vec_prev_qtde + pap_adq
# Preenchendo o custo
df_sim[i,paste("Custo",papeis_carteira,sep="_")] <- df_sim[i-1,paste("Custo",papeis_carteira,sep="_")] + round(pap_adq*df_sim[i,papeis_carteira],2)
# Preenchendo o PM
df_sim[i,paste("PM",papeis_carteira,sep="_")] <- round(df_sim[i,paste("Custo",papeis_carteira,sep="_")]/df_sim[i,paste("Qtde",papeis_carteira,sep="_")],2)
# Preenchendo o Valor de Mercado
df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")] <- round(df_sim[i,paste("Qtde",papeis_carteira,sep="_")]*df_sim[i,papeis_carteira],2)
# Preenchendo a Valorização
df_sim[i,paste("Valorizacao",papeis_carteira,sep="_")] <- round((df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")]-df_sim[i,paste("Custo",papeis_carteira,sep="_")])/df_sim[i,paste("Custo",papeis_carteira,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df_sim[i,paste("Concentracao",papeis_carteira,sep="_")] <- round(df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")]/sum(df_sim[i,grep("ValorMercado",names(df_sim),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df_sim[i,paste("Provent",papeis_carteira,sep="_")] <- vec_valo_prov
# Calculando o montante dos proventos
df_sim$Montante_Prove[i] <- sum(vec_valo_prov)
# Calculando o saldo restante
df_sim$Saldo_Restante[i] <- (aporte_mensal + df_sim$Saldo_Restante[i-1] + sum(vec_valo_prov)) - sum(round(pap_adq*df_sim[i,papeis_carteira],2))
# Valor consolidado da carteira
df_sim$Valor_Carteira[i] <- sum(df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")])
# CUsto consolidado da carteira
df_sim$Custo_Carteira[i] <- sum(df_sim[i,paste("Custo",papeis_carteira,sep="_")])
}
df_sim[format(df_sim$Data,"%Y")=="2014",c("Data",grep("SANB3",names(df_sim),value=T))]
i <- 18
# Criando os vetores auxiliares
vec_prev_qtde <- df_sim[i-1,paste("Qtde",papeis_carteira,sep="_")]
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papeis_carteira,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papeis_carteira,sep="_")
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papeis_carteira,df_sim$Data[i],df_sim$Data[i-1])
vec_prev_qtde
df_sim[i-1,paste("Qtde",papeis_carteira,sep="_")]
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papeis_carteira,df_sim$Data[i],df_sim$Data[i-1])
vec_prev_qtde
vec_pr_qt = vec_prev_qtde
papel = papeis_carteira
dt = df_sim$Data[i]
prev_dt = df_sim$Data[i-1])
prev_dt = df_sim$Data[i-1]
vec_pr_qt = vec_prev_qtde
papel = papeis_carteira
dt = df_sim$Data[i]
prev_dt = df_sim$Data[i-1]
# desdob <- df_desd2[df_desd2$Papel==papeis_carteira[colu] & df_desd2$DataCom <= dt & df_desd2$DataCom > prev_dt,]
desdob <- df_desd2[df_desd2$DataCom <= dt & df_desd2$DataCom > prev_dt,]
desdob
(nrow(desdob)>0)
seq(nrow(desdob))
colu <- which(papel == desdob$Papel[j])
colu
j <- 1
colu <- which(papel == desdob$Papel[j])
colu
desdob$Tipo[j]
(desdob$Tipo[j]=="Bonificação")
vec_pr_qt
round(vec_pr_qt[colu]*(1 + (desdob$Fator1[j]/100)),0)
vec_pr_qt[colu] <- round(vec_pr_qt[colu]*(1 + (desdob$Fator1[j]/100)),0)
(desdob$Tipo[j]=="Grupamento|Desdobramento")
j <- 2
colu <- which(papel == desdob$Papel[j])
colu
(desdob$Tipo[j]=="Bonificação")
(desdob$Tipo[j]=="Grupamento|Desdobramento")
desdob$Tipo[j]
(desdob$Tipo[j]=="Grupamento|Desdobramento")
(desdob$Tipo[j] %in% c("Grupamento","Desdobramento"))
vec_pr_qt[colu] <- round(vec_pr_qt[colu]*( desdob$Fator2[j]/desdob$Fator1[j]   ),0)
vec_pr_qt
source('C:/Users/Diego/Desktop/Data_Science/Investimentos/Analise_Aportes/funcoes.R', encoding = 'UTF-8')
source('C:/Users/Diego/Desktop/Data_Science/Investimentos/Analise_Aportes/funcoes.R', encoding = 'UTF-8')
# Criando a base para simulação
df_sim <- df_cot4
row.names(df_sim) <- seq(nrow(df_sim))
for(colu in seq(TAM)){
x <- data.frame(rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)),rep(0,nrow(df_cot4)))
names(x) <- c(paste("Custo",papeis_carteira[colu],sep="_"),paste("Qtde",papeis_carteira[colu],sep="_"),paste("PM",papeis_carteira[colu],sep="_"),
paste("ValorMercado",papeis_carteira[colu],sep="_"),paste("Valorizacao",papeis_carteira[colu],sep="_"),paste("Concentracao",papeis_carteira[colu],sep="_"),
paste("Provent",papeis_carteira[colu],sep="_"))
df_sim <- cbind(df_sim,x)
}
df_sim$Montante_Prove <- 0
df_sim$Saldo_Restante <- 0
df_sim$Valor_Carteira <- 0
df_sim$Custo_Carteira <- 0
# head(df_sim)
# Gerando o aporte inicial
apo_ini_por_ppl <- aporte_inicial/TAM
# for(colu in seq(TAM)){
# # Preenchendo a quantidade de ações
# df_sim[1,paste("Qtde",papeis_carteira[colu],sep="_")] <- floor(apo_ini_por_ppl/df_sim[1,papeis_carteira[colu]])
#
# # Preenchendo o custo
# df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")] <- round(df_sim[1,paste("Qtde",papeis_carteira[colu],sep="_")]*df_sim[1,papeis_carteira[colu]],2)
#
# # Preenchendo o PM
# df_sim[1,paste("PM",papeis_carteira[colu],sep="_")] <- df_sim[1,papeis_carteira[colu]]
#
# # Preenchendo o Valor de Mercado
# df_sim[1,paste("ValorMercado",papeis_carteira[colu],sep="_")] <- df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")]
#
# # Preenchendo a Valorização
# df_sim[1,paste("Valorizacao",papeis_carteira[colu],sep="_")] <- round((df_sim[1,paste("ValorMercado",papeis_carteira[colu],sep="_")]-df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")])/df_sim[1,paste("Custo",papeis_carteira[colu],sep="_")],2)
#
# # Preenchendo a concentração no papel dentro da carteira
# df_sim[1,paste("Concentracao",papeis_carteira[colu],sep="_")] <- round(df_sim[1,paste("ValorMercado",papeis_carteira[colu],sep="_")]/sum(df_sim[1,grep("ValorMercado",names(df_sim),value=T)]),2)
#
# # Preenchendo o montante de proventos recebidos para o dado papel no dado mês
# df_sim[1,paste("Provent",papeis_carteira[colu],sep="_")] <- 0
# }
##############################################
# Preenchendo os dados do primeiro mês
##############################################
# Preenchendo a quantidade de ações
df_sim[1,paste("Qtde",papeis_carteira,sep="_")] <- floor(apo_ini_por_ppl/df_sim[1,papeis_carteira])
# Preenchendo o custo
df_sim[1,paste("Custo",papeis_carteira,sep="_")] <- round(df_sim[1,paste("Qtde",papeis_carteira,sep="_")]*df_sim[1,papeis_carteira],2)
# Preenchendo o PM
df_sim[1,paste("PM",papeis_carteira,sep="_")] <- df_sim[1,papeis_carteira]
# Preenchendo o Valor de Mercado
df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")] <- df_sim[1,paste("Custo",papeis_carteira,sep="_")]
# Preenchendo a Valorização
df_sim[1,paste("Valorizacao",papeis_carteira,sep="_")] <- round((df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")]-df_sim[1,paste("Custo",papeis_carteira,sep="_")])/df_sim[1,paste("Custo",papeis_carteira,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df_sim[1,paste("Concentracao",papeis_carteira,sep="_")] <- round(df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")]/sum(df_sim[1,grep("ValorMercado",names(df_sim),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df_sim[1,paste("Provent",papeis_carteira,sep="_")] <- 0
df_sim$Montante_Prove <- 0
df_sim[1,"Saldo_Restante"] <- aporte_inicial - sum(df_sim[grep("Custo",names(df_sim),value=T)])
df_sim$Valor_Carteira[1] <- sum(df_sim[1,paste("ValorMercado",papeis_carteira,sep="_")])
df_sim$Custo_Carteira[1] <- sum(df_sim[1,paste("Custo",papeis_carteira,sep="_")])
# head(df_sim)
# sum(df_sim[1,grep("Concentracao",names(df_sim),value=T)])
# Gerando os aportes mensais
for(i in seq(2,nrow(df_sim))){
# Criando os vetores auxiliares
vec_prev_qtde <- df_sim[i-1,paste("Qtde",papeis_carteira,sep="_")]
vec_valo_prov <- rep(0,TAM); names(vec_valo_prov) <- paste("Proven",papeis_carteira,sep="_")
vec_valo_apor <- rep(0,TAM); names(vec_valo_apor) <- paste("Aporte",papeis_carteira,sep="_")
############################################################
# Função de desdobramentos, grupamentos e bonificações
############################################################
vec_prev_qtde <- desdobramentos(vec_prev_qtde,papeis_carteira,df_sim$Data[i],df_sim$Data[i-1])
############################################################
# Função de proventos
############################################################
vec_valo_prov <- desdobramentos(vec_valo_prov,papeis_carteira,df_sim$Data[i],df_sim$Data[i-1])
############################################################
# Função de aportes
############################################################
# Calculando o valor atual
valor_atual <- round(vec_prev_qtde*df_sim[i,papeis_carteira],2)
# Calculando o custo atual
custo_atual <- df_sim[i-1,paste("Custo",papeis_carteira,sep="_")]
# Calculando a Valorização atual
valorizacao_atual <- round((valor_atual-custo_atual)/custo_atual,4)
# Calculando a distribuição atual
distrib_atual <- round(valor_atual/sum(valor_atual),2)
# Chamando a função para calcular quanto aportar em cada ação
vec_valo_apor <- aportes(vec_valo_apor,vec_valo_prov,papeis_carteira,valorizacao_atual,distrib_atual,aporte_mensal,df_sim$Saldo_Restante[i-1],vec_pesos)
###########################################################
# Comprando ações
###########################################################
# Calculando quantidade de papéis adquiridos
pap_adq <- floor(vec_valo_apor/df_sim[i,papeis_carteira])
###########################################################
# Preenchendo as informações do mês após as compras
###########################################################
# Preenchendo a quantidade de ações após compra
df_sim[i,paste("Qtde",papeis_carteira,sep="_")] <- vec_prev_qtde + pap_adq
# Preenchendo o custo
df_sim[i,paste("Custo",papeis_carteira,sep="_")] <- df_sim[i-1,paste("Custo",papeis_carteira,sep="_")] + round(pap_adq*df_sim[i,papeis_carteira],2)
# Preenchendo o PM
df_sim[i,paste("PM",papeis_carteira,sep="_")] <- round(df_sim[i,paste("Custo",papeis_carteira,sep="_")]/df_sim[i,paste("Qtde",papeis_carteira,sep="_")],2)
# Preenchendo o Valor de Mercado
df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")] <- round(df_sim[i,paste("Qtde",papeis_carteira,sep="_")]*df_sim[i,papeis_carteira],2)
# Preenchendo a Valorização
df_sim[i,paste("Valorizacao",papeis_carteira,sep="_")] <- round((df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")]-df_sim[i,paste("Custo",papeis_carteira,sep="_")])/df_sim[i,paste("Custo",papeis_carteira,sep="_")],2)
# Preenchendo a concentração no papel dentro da carteira
df_sim[i,paste("Concentracao",papeis_carteira,sep="_")] <- round(df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")]/sum(df_sim[i,grep("ValorMercado",names(df_sim),value=T)]),2)
# Preenchendo o montante de proventos recebidos para o dado papel no dado mês
df_sim[i,paste("Provent",papeis_carteira,sep="_")] <- vec_valo_prov
# Calculando o montante dos proventos
df_sim$Montante_Prove[i] <- sum(vec_valo_prov)
# Calculando o saldo restante
df_sim$Saldo_Restante[i] <- (aporte_mensal + df_sim$Saldo_Restante[i-1] + sum(vec_valo_prov)) - sum(round(pap_adq*df_sim[i,papeis_carteira],2))
# Valor consolidado da carteira
df_sim$Valor_Carteira[i] <- sum(df_sim[i,paste("ValorMercado",papeis_carteira,sep="_")])
# CUsto consolidado da carteira
df_sim$Custo_Carteira[i] <- sum(df_sim[i,paste("Custo",papeis_carteira,sep="_")])
}
df_sim[format(df_sim$Data,"%Y")=="2014",c("Data",grep("SANB3",names(df_sim),value=T))]
plot(x=df_sim$Data,y=df_sim$Valor_Carteira,col="blue",type="l")
lines(x=df_sim$Data,y=df_sim$Custo_Carteira,col="red")
df_sim[format(df_sim$Data,"%Y")=="2016",c("Data",grep("SANB3",names(df_sim),value=T))]
df_sim[format(df_sim$Data,"%Y")=="2016",]
df_desd2
